"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/algorithm.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-th")+e.resolveComponent("uni-tr")+e.resolveComponent("uni-table")+e.resolveComponent("uni-popup"))()}Math||(n+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-table/components/uni-th/uni-th.js")+(()=>"../../uni_modules/uni-table/components/uni-tr/uni-tr.js")+(()=>"../../uni_modules/uni-table/components/uni-table/uni-table.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const n=()=>"../../Components/echarts/l-echart/l-echart.js",a={__name:"shortest",setup(n){const a=e.ref([]),l=e.ref(""),o=e.ref(null);let s=e.ref([]),r=e.ref(0);const i=["#5c7bd9","red","green","blue","purple","orange"],u=i.length,c=()=>{a.value.push([])};let p=new Map,d=new Map;const v=()=>{try{const e=new Set(l.value.trim().split(/\s+/));if(!e)throw new Error("节点不允许为空");if(!o.value)throw new Error("起点不允许为空");if(!e.has(o.value))throw new Error("起点不存在");r.value=0,b.series[0].data=[],b.series[0].links=[],I=[],M=[],C=[],p.clear(),d.clear(),E.value.clear(),s.value=t.dijkstra(a.value,e,o.value),b.series[0].data=((e,t,n=20)=>{const a=[];let l=0;e.forEach((e=>{p.set(e,l),a.push({name:e,colorIndex:0,color:i[0],value0:t,value1:t===e?0:"Infinity",detail:""}),l++}));let o=360/l*Math.PI/180;for(let s=0;s<l;s++)a[s].x=parseInt(Math.sin(o*s)*n),a[s].y=parseInt(-Math.cos(o*s)*n),a[s].value=[a[s].x,a[s].y];return a})(e,o.value);let n=0;a.value.forEach((([t,a,l])=>{if(!t||!a||!l)throw new Error("不允许空值");if(!e.has(t)||!e.has(a))throw new Error(`${t}->${a}存在未定义节点`);b.series[0].links.push({source:t,target:a,label:{show:!0,formatter:l},tooltip:{show:!1},lineStyle:{color:i[0]}}),d.set(`${t}--${a}`,n++)})),T=b.series[0].links,S(!1),O=!1}catch(n){console.log(n.message),e.index.showToast({title:n.message,icon:"error",duration:1e3})}},h=e.ref(null);let f=null,g=e.ref(0),m=e.ref(0);const y=require("../../static/echarts.min.js");let b={title:{text:"最短路径"},tooltip:{triggerOn:"none",formatter:e=>`(${e.data.value0}, ${e.data.value1})\n${e.data.detail}`},xAxis:{show:!1,min:-30,max:30},yAxis:{show:!1,min:-30,max:30},animation:!1,series:[{type:"graph",layout:"none",coordinateSystem:"cartesian2d",symbolSize:40,label:{show:!0},edgeLabel:{fontSize:20},itemStyle:{color:function(e){return e.data.color}},data:[],links:[],lineStyle:{opacity:.9,width:2,curveness:0}}]};const x=e=>{f.dispatchAction({type:"showTip",seriesIndex:0,dataIndex:e})},w=e=>{f.dispatchAction({type:"hideTip"})},$=()=>{f.setOption({graphic:y.util.map(b.series[0].data,(function(e,t){return{id:t,position:f.convertToPixel("grid",e.value)}}))})};function k(e){!function(e,t){b.series[0].data[e].x=t[0],b.series[0].data[e].y=t[1],b.series[0].data[e].value=t,f.setOption(b),$();for(let n=0;n<I.length;n++)I[n][e].x=t[0],I[n][e].y=t[1],I[n][e].value=t}(e,f.convertFromPixel("grid",this.position))}const S=(t=!0)=>{f.setOption(b),t||f.setOption({graphic:y.util.map(b.series[0].data,(function(t,n){return{type:"circle",id:n,position:f.convertToPixel("grid",t.value),shape:{cx:0,cy:0,r:20},invisible:!0,draggable:!0,z:100,ondrag:y.util.curry(e.lodashExports.debounce(k,0),n),onmousemove:y.util.curry(x,n),onmouseout:y.util.curry(w,n)}}))}),$()},j=e.ref(null);let E=e.ref(new Map),O=!1;const _=()=>{j.value.open()};let I=[],M=[],C=[],T=null;const J=t=>{if(M.length>t&&I.length>t)b.series[0].data=e.lodashExports.cloneDeep(I[t]),b.series[0].links=e.lodashExports.cloneDeep(M[t]),E.value=e.lodashExports.cloneDeep(C[t]);else if(b.series[0].links=T,T=JSON.parse(JSON.stringify(b.series[0].links)),t<=s.value.length){const e=s.value[t-1],n=Object.keys(e)[0],a=e[n],l=p.get(n),r=b.series[0].data[l].colorIndex++,c=i[(r+1)%u];b.series[0].data[l].color=c;let v=1/0,h=-1,f=null,g=`从点${n}出发\n`;for(const[t,s]of a){const e=p.get(t);b.series[0].data[e].value0=n,b.series[0].data[e].value1=s;let a;g+=`到达点${t}，长度为${s-b.series[0].data[l].value1}\n`,d.has(`${n}--${t}`)?a=d.get(`${n}--${t}`):d.has(`${t}--${n}`)&&(a=d.get(`${t}--${n}`)),s<=v&&(v=s,h=a,f=t),b.series[0].links[a].lineStyle.color=c;let r=`${o.value}`;E.value.has(n)&&(r=E.value.get(n)[0]),r+=`->${t}`,E.value.set(t,[r,s])}v!==1/0&&(g+=`确定最短路径${n}->${f}`,b.series[0].data[l].detail=g,T[h].lineStyle.color="orange")}S()},N=()=>{r.value--,r.value<0?r.value=0:J(r.value)},A=()=>{let t=!1;r.value++,r.value>s.value.length&&(r.value=s.value.length,t=!0,e.index.showToast({title:"已经是最后一张图了",icon:"none",duration:1e3})),M.length<r.value&&I.length<r.value&&(I.push(JSON.parse(JSON.stringify(b.series[0].data))),M.push(JSON.parse(JSON.stringify(b.series[0].links))),C.push(e.lodashExports.cloneDeep(E.value))),r.value!=s.value.length||O||(O=!0,_()),t||J(r.value)};return e.onMounted((()=>{e.index.createSelectorQuery().select(".chartRef").boundingClientRect((({width:e,height:t})=>{g.value=e,m.value=t})).exec(),setTimeout((async()=>{h.value&&(f=await h.value.init(y))}),0)})),e.onBeforeUnmount((()=>{h.value.dispose(),h.value=null})),(t,n)=>e.e({a:l.value,b:e.o((e=>l.value=e.detail.value)),c:e.o(c),d:e.f(a.value,((t,n,l)=>({a:t[0],b:e.o((e=>t[0]=e.detail.value),n),c:t[1],d:e.o((e=>t[1]=e.detail.value),n),e:t[2],f:e.o((e=>t[2]=e.detail.value),n),g:e.o((e=>(e=>{a.value.splice(e,1)})(n)),n),h:n}))),e:o.value,f:e.o((e=>o.value=e.detail.value)),g:e.o(v),h:e.sr(h,"1e9cd37b-0",{k:"chartRef"}),i:e.o((()=>{})),j:e.unref(s).length},e.unref(s).length?{k:e.o(_),l:e.p({type:"more-filled"}),m:e.o(N),n:e.p({type:"back"}),o:e.o(A),p:e.p({type:"forward"})}:{},{q:e.f(e.unref(E).entries(),((t,n,a)=>({a:e.t(t[0]),b:"1e9cd37b-11-"+a+",1e9cd37b-10-"+a,c:e.t(t[1][0]),d:"1e9cd37b-12-"+a+",1e9cd37b-10-"+a,e:e.t(t[1][1]),f:"1e9cd37b-13-"+a+",1e9cd37b-10-"+a,g:n,h:"1e9cd37b-10-"+a+",1e9cd37b-5"}))),r:e.p({align:"center"}),s:e.p({align:"center"}),t:e.p({align:"center"}),v:e.sr(j,"1e9cd37b-4",{k:"popup"}),w:e.p({type:"center","border-radius":"10px 10px 10px 10px","background-color":"#fff"})})}},l=e._export_sfc(a,[["__scopeId","data-v-1e9cd37b"]]);wx.createPage(l);
