"use strict";const e=require("../../common/vendor"),t=require("../../utils/algorithm.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-th")+e.resolveComponent("uni-tr")+e.resolveComponent("uni-table")+e.resolveComponent("uni-popup"))()}Math||(a+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-table/components/uni-th/uni-th.js")+(()=>"../../uni_modules/uni-table/components/uni-tr/uni-tr.js")+(()=>"../../uni_modules/uni-table/components/uni-table/uni-table.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const a=()=>"../../Components/echarts/l-echart/l-echart.js",n={__name:"shortest",setup(a){const n=e.ref([]),o=e.ref(""),l=e.ref(null);let s=e.ref([]),r=e.ref(0);const i=["#5c7bd9","red","green","blue","purple","orange"],u=i.length,c=()=>{n.value.push([])};let p=new Map,d=new Map;const h=()=>{try{const e=new Set(o.value.trim().split(/\s+/));if(!e)throw new Error("节点不允许为空");if(!l.value)throw new Error("起点不允许为空");if(!e.has(l.value))throw new Error("起点不存在");r.value=0,y.series[0].data=[],y.series[0].links=[],_=[],I=[],M=[],p.clear(),d.clear(),E.value.clear(),s.value=t.dijkstra(n.value,e,l.value),y.series[0].data=((e,t,a=20)=>{const n=[];let o=0;e.forEach((e=>{p.set(e,o),n.push({name:e,colorIndex:0,color:i[0],value0:t,value1:t===e?0:"Infinity",detail:""}),o++}));let l=360/o*Math.PI/180;for(let s=0;s<o;s++)n[s].x=parseInt(Math.sin(l*s)*a),n[s].y=parseInt(-Math.cos(l*s)*a),n[s].value=[n[s].x,n[s].y];return n})(e,l.value);let a=0;n.value.forEach((([t,n,o])=>{if(!t||!n||!o)throw new Error("不允许空值");if(!e.has(t)||!e.has(n))throw new Error(`${t}->${n}存在未定义节点`);y.series[0].links.push({source:t,target:n,label:{show:!0,formatter:o},tooltip:{show:!1},lineStyle:{color:i[0]}}),d.set(`${t}--${n}`,a++)})),C=y.series[0].links,S(!1)}catch(a){console.log(a.message),e.index.showToast({title:a.message,icon:"error",duration:1e3})}},v=e.ref(null);let f=null,g=e.ref(0),m=e.ref(0);const b=require("../../static/echarts.min.js");let y={title:{text:"最短路径"},tooltip:{triggerOn:"none",formatter:e=>`(${e.data.value0}, ${e.data.value1})\n${e.data.detail}`},xAxis:{show:!1,min:-30,max:30},yAxis:{show:!1,min:-30,max:30},animation:!1,series:[{type:"graph",layout:"none",coordinateSystem:"cartesian2d",symbolSize:40,label:{show:!0},edgeLabel:{fontSize:20},itemStyle:{color:function(e){return e.data.color}},data:[],links:[],lineStyle:{opacity:.9,width:2,curveness:0}}]};const x=e=>{f.dispatchAction({type:"showTip",seriesIndex:0,dataIndex:e})},w=e=>{f.dispatchAction({type:"hideTip"})},$=()=>{f.setOption({graphic:b.util.map(y.series[0].data,(function(e,t){return{id:t,position:f.convertToPixel("grid",e.value)}}))})};function k(e){!function(e,t){y.series[0].data[e].x=t[0],y.series[0].data[e].y=t[1],y.series[0].data[e].value=t,f.setOption(y),$();for(let a=0;a<_.length;a++)_[a][e].x=t[0],_[a][e].y=t[1],_[a][e].value=t}(e,f.convertFromPixel("grid",this.position))}const S=(t=!0)=>{f.setOption(y),t||f.setOption({graphic:b.util.map(y.series[0].data,(function(t,a){return{type:"circle",id:a,position:f.convertToPixel("grid",t.value),shape:{cx:0,cy:0,r:20},invisible:!0,draggable:!0,z:100,ondrag:b.util.curry(e.lodashExports.debounce(k,0),a),onmousemove:b.util.curry(x,a),onmouseout:b.util.curry(w,a)}}))}),$()},j=e.ref(null);let E=e.ref(new Map);const O=()=>{j.value.open()};let _=[],I=[],M=[],C=null;const J=t=>{if(I.length>t&&_.length>t)y.series[0].data=e.lodashExports.cloneDeep(_[t]),y.series[0].links=e.lodashExports.cloneDeep(I[t]),E.value=e.lodashExports.cloneDeep(M[t]);else if(y.series[0].links=C,C=JSON.parse(JSON.stringify(y.series[0].links)),t<=s.value.length){const e=s.value[t-1],a=Object.keys(e)[0],n=e[a],o=p.get(a),r=y.series[0].data[o].colorIndex++,c=i[(r+1)%u];y.series[0].data[o].color=c;let h=1/0,v=-1,f=null,g=`从点${a}出发\n`;for(const[t,s]of n){const e=p.get(t);y.series[0].data[e].value0=a,y.series[0].data[e].value1=s;let n;g+=`到达点${t}，长度为${s-y.series[0].data[o].value1}\n`,d.has(`${a}--${t}`)?n=d.get(`${a}--${t}`):d.has(`${t}--${a}`)&&(n=d.get(`${t}--${a}`)),s<=h&&(h=s,v=n,f=t),y.series[0].links[n].lineStyle.color=c;let r=`${l.value}`;E.value.has(a)&&(r=E.value.get(a)[0]),r+=`->${t}`,E.value.set(t,[r,s])}g+=`确定最短路径${a}->${f}`,y.series[0].data[o].detail=g,C[v].lineStyle.color="orange"}S()},N=()=>{r.value--,r.value<0?r.value=0:J(r.value)},T=()=>{r.value=Math.min(r.value+1,s.value.length+1),I.length<r.value&&_.length<r.value&&(_.push(JSON.parse(JSON.stringify(y.series[0].data))),I.push(JSON.parse(JSON.stringify(y.series[0].links))),M.push(e.lodashExports.cloneDeep(E.value))),J(r.value)};return e.onMounted((()=>{e.index.createSelectorQuery().select(".chartRef").boundingClientRect((({width:e,height:t})=>{g.value=e,m.value=t})).exec(),setTimeout((async()=>{v.value&&(f=await v.value.init(b))}),0)})),e.onBeforeUnmount((()=>{v.value.dispose(),v.value=null})),(t,a)=>e.e({a:o.value,b:e.o((e=>o.value=e.detail.value)),c:e.o(c),d:e.f(n.value,((t,a,o)=>({a:t[0],b:e.o((e=>t[0]=e.detail.value),a),c:t[1],d:e.o((e=>t[1]=e.detail.value),a),e:t[2],f:e.o((e=>t[2]=e.detail.value),a),g:e.o((e=>(e=>{n.value.splice(e,1)})(a)),a),h:a}))),e:l.value,f:e.o((e=>l.value=e.detail.value)),g:e.o(h),h:e.sr(v,"cfdbb6c8-0",{k:"chartRef"}),i:e.o((()=>{})),j:e.unref(s).length},e.unref(s).length?{k:e.o(O),l:e.p({type:"more-filled"}),m:e.o(N),n:e.p({type:"back"}),o:e.o(T),p:e.p({type:"forward"})}:{},{q:e.f(e.unref(E).entries(),((t,a,n)=>({a:e.t(t[0]),b:"cfdbb6c8-11-"+n+",cfdbb6c8-10-"+n,c:e.t(t[1][0]),d:"cfdbb6c8-12-"+n+",cfdbb6c8-10-"+n,e:e.t(t[1][1]),f:"cfdbb6c8-13-"+n+",cfdbb6c8-10-"+n,g:a,h:"cfdbb6c8-10-"+n+",cfdbb6c8-5"}))),r:e.p({align:"center"}),s:e.p({align:"center"}),t:e.p({align:"center"}),v:e.sr(j,"cfdbb6c8-4",{k:"popup"}),w:e.p({type:"center","border-radius":"10px 10px 10px 10px","background-color":"#fff"})})}},o=e._export_sfc(n,[["__scopeId","data-v-cfdbb6c8"]]);wx.createPage(o);
